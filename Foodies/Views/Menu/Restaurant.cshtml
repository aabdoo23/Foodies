@model IEnumerable<Restaurant>

<html>
<head>
    <title>Restaurant List</title>
    <link rel="stylesheet" href="~/css/restaurant.css">
    <link rel="stylesheet" href="~/css/Main.css">
    <link rel="script" href="~\js\sefr.js" >
</head>

<body>
    <br /><br />
    <div class="category-bar d-flex justify-content-center">
        @{
            var ef = Model.Select(r => r.CuisineType).Distinct();
            foreach (var i in ef)
            {
                        <div class="category-item" data-category="@i">
                            <button class="category-button">@i</button>
                        </div>
            }
        }
    </div>

    <div class="search-section">
        <div class="search-group">
            <input id="restaurantSearch" placeholder="Search" type="search" class="search-input">
        </div>
    </div>

    <div class="restaurant-cards">
        @foreach (var restaurant in Model)
        {
                <div  class="restaurant-card" data-cuisine-type="@restaurant.CuisineType">
                            <div  style="display: none;"  class="restaurant-name">@restaurant.Name</div>

    <div class="food-card" >
                    <div class="food-card-fav">
                    @{
                        if (@ViewBag.fav.FavouriteRestaurants != null && @ViewBag.fav.FavouriteRestaurants.Count > 0)
                        {

                            foreach (var r in @ViewBag.fav.FavouriteRestaurants)
                            {
                                if (r.Id == restaurant.Id)
                                {
                                          <i class="bi bi-heart-fill" id = "fav-@restaurant.Id" onclick="addToFavourites(@restaurant.Id)"></i>
                                    break;
                                }
                                else
                                {
                                     <i class="bi bi-heart" id = "fav-@restaurant.Id" onclick="addToFavourites(@restaurant.Id)"></i>
                                    break;
                                }
                            }
                        }
                        else
                        {
                                                         <i class="bi bi-heart" id = "fav-@restaurant.Id" onclick="addToFavourites(@restaurant.Id)"></i>
                        }

                    }

                             <img class="food-card-img" src="@restaurant.Photo" alt="food image" 
        onclick="window.location.href='@restaurant.Photo'"/> 
        </div>

 </div>
                   <div class="rating-container">
                        <button class="btn btn-warning btn-sm rate-restaurant" data-restaurant-id="@restaurant.Id">Rate Restaurant</button>
                        <div class="rating-input" style="display: none;">
                            <input type="number" min="1" max="5" step="0.1" placeholder="Rate (1-5)" class="form-control" />
                            <button class="btn btn-primary submit-rating" data-restaurant-id="@restaurant.Id">Submit</button>
                        </div>
                    </div>
               
                </div>
        }

    </div>

</body>
</html>

<script>
    document.querySelectorAll('.category-item button').forEach(item => {
        item.addEventListener('click', function(event) {
            event.preventDefault();
            var selectedCategory = this.closest('.category-item').getAttribute('data-category');
            var restaurantCards = document.querySelectorAll('.restaurant-card');

            restaurantCards.forEach(card => {
                var cuisineType = card.getAttribute('data-cuisine-type');
                if (cuisineType === selectedCategory || selectedCategory === 'All') {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });
    });

    document.getElementById('restaurantSearch').addEventListener('input', function() {
        var searchQuery = this.value.toLowerCase();
        var restaurantCards = document.querySelectorAll('.restaurant-card');

        restaurantCards.forEach(card => {
            var restaurantName = card.querySelector('.restaurant-name').textContent.toLowerCase();
            if (restaurantName.includes(searchQuery)) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    });

    document.addEventListener('DOMContentLoaded', function () {
        const rateButtons = document.querySelectorAll('.rate-restaurant');

        rateButtons.forEach(button => {
            button.addEventListener('click', function () {
                const ratingInput = this.nextElementSibling;
                ratingInput.style.display = ratingInput.style.display === 'none' ? 'flex' : 'none';
            });
        });

        const submitButtons = document.querySelectorAll('.submit-rating');

        submitButtons.forEach(button => {
            button.addEventListener('click', async function () {
                const restaurantId = this.getAttribute('data-restaurant-id');
                const ratingValue = this.previousElementSibling.value;

                if (ratingValue) {
                    const response = await fetch(`/Menu/AddRating`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ RestaurantId: restaurantId, Rate: parseFloat(ratingValue) })
                    });

                    if (response.ok) {
                        alert('Thank you for your rating!');
                        location.reload();
                    } else {
                        alert('An error occurred while submitting your rating.');
                    }
                } else {
                    alert('Please enter a rating.');
                }
            });
        });
    });
     function addToFavourites(resId) {
        var button = document.getElementById("fav-" + resId);

        if (button.classList.contains("bi-heart")) {
            button.classList.remove("bi-heart");
            console.log("hello");
            button.classList.add("bi-heart-fill");

            $.ajax({
                url: '/menu/addToFav', 
                type: 'post', 
                data: { resId: resId },
                success: function(response) {
                    alert('added to fav');
                },
                error: function(err) {
                    console.error('Error adding to fav', err);
                }
            });
        }
        else {
            button.classList.remove("bi-heart-fill");
            button.classList.add("bi-heart");
            $.ajax({
                url: '/menu/removeFav', 
                type: 'post', 
                data: { resId: resId },
                success: function(response) {
                    alert('rem from fav');
                },
                error: function(err) {
                    console.error('Error rem  fav', err);
                }
            });
        }


    }
</script>


<style>
.category-button {
    background-color: #b6200c;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px; 
    cursor: pointer;
    font-size: 16px;
    transition: background-color 0.3s ease; 
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); 
    margin: 5px;
}

.category-button:hover {
    background-color: #b6200c; 
    box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
}

.category-button:active {
    background-color: #b6200c; 
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    transform: translateY(2px);
}

.search-section {
    display: flex;
    justify-content: center;
    margin: 20px 0;
}

.search-group {
    position: relative; 
    width: 100%;
    max-width: 500px;
}

.search-input {
    width: 100%; 
    padding: 12px 20px; 
    font-size: 16px;
    border: 2px solid #3498db;
    border-radius: 25px;
    outline: none; 
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: border-color 0.3s ease, box-shadow 0.3s ease; 
}

.search-input::placeholder {
    color: #7f8c8d;
    font-style: italic; 
}

/* Focus Effect */
.search-input:focus {
    border-color: #2980b9;
    box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15); 
}

.search-group::before {
    content: '\f002';
    font-family: 'FontAwesome';
    position: absolute;
    left: 15px; 
    top: 50%;
    transform: translateY(-50%);
    color: #7f8c8d;
    font-size: 16px;
}

.rating-container {
    margin-top: 10px;
    display: flex; 
    align-items: center;
}

.rating-input {
    display: flex;
    align-items: center;
    margin-left: 10px;
}

.form-control {
    width: 80px; 
    padding: 5px;
    border: 1px solid #ccc;
    border-radius: 4px;
    margin-right: 5px; 
}

.submit-rating {
    margin-left: 5px;
}
    .faIcon {
        font-size: 35px;
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top: 5px;
        color: var(--white);


    }

    /* menuitem card */

    .food-card {
        width: 350px;
        height: 300px;
        padding: .8em;
        background: var(--white);
        position: relative;
        overflow: visible;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
        border-radius: 15px;
        transition: .3s ease;
        cursor: pointer;
        margin-top: 10px;
        margin-right: 30px;
    }

    .food-card-img {
        background-color: #ffcaa6;
        width: 70%;
        height: auto;
        border-radius: 17px;
        display: block; /* Ensures that the image behaves as a block-level element */
        margin-left: auto;
        margin-right: auto;
        margin-top:-40px;
         z-index: 1; 
    }



    /*icon facourite*/
    .food-card-fav {

        /* margin: -1em 20px; */
        /* margin-right:40px; */
        display: flex;
        /* align-items: right; */
        justify-content: flex-end;
        padding: 0rem 1rem;
        padding-top:0.1rem;
        text-align: right;
        border:none;

    }
    .bi-heart, .bi-heart-fill{
        font-size: 1.9rem;
        z-index: 2;
        border-raduis: 14px;

    }
    .bi-heart{
        color:  var(--black);
    }
    .bi-heart-fill{
       color:  red;
    }
    .bi-heart:hover , .bi-heart-fill:hover{
    transform: scale(1.05); /* Slightly scale up the box */

    color: rgba(255, 100, 50, 0.9); /* Red shade on hover (with 30% opacity) */

}    
    /*Text*/
.food-card-text-title {
    font-weight: 700;
    font-size: 1.2em;
    color: var(--black);
    text-align: center;
   margin-top: 5px;

}





   /*  .food-card-footer {
        display: flex;
        align-items: center;

        position: absolute;
        bottom: 0;
        width: 100%;
        margin: 10px 0;
    }
 */
    /* .food-card-footer-text {
        font-weight: 400;
        font-size: 1em;
        color: var(--black);
        margin: 0 10px;
    }
 */


    /*Hover*/
    .food-card:hover {
        transform: translateY(-1%);
        box-shadow: var(--teirtary-color) 0px 13px 47px -5px, var(--secondary-color) 0px 8px 16px -8px;
    }
</style>
